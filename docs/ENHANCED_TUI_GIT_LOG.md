# ai-commit Enhanced TUI - Git Log Viewer

## ✨ 新增功能

增强版 TUI (`--query-tui-pro`) 现在不仅支持查询历史，还提供了完整的 Git 日志查看功能，类似于 GRV。

### 主要特性

1. **Git 提交历史查看**
   - 显示最近 100 个提交
   - 包含哈希、消息、作者和时间信息
   - 彩色高亮不同类型的提交（feat: 绿色, fix: 红色, docs: 蓝色）

2. **提交详情和 Diff 查看**
   - 选中提交后自动加载其 diff 内容
   - 分屏显示提交信息和代码变更
   - 支持滚动查看长 diff 内容

3. **增强的导航功能**
   - `g` - 跳转到第一个提交
   - `G` - 跳转到最后一个提交
   - `f/PageDown` - 向下翻页
   - `b/PageUp` - 向上翻页
   - `r` - 刷新 Git 日志

### 使用方法

```bash
# 启动增强版 TUI
ai-commit --query-tui-pro

# 或使用别名（如果已配置）
acqp
```

### 界面布局

```
┌─[Git Log]─────────────────────────────────────────────┐
│ a8e31de2 08-23 23:25 refactor: add 日志收集 - costa   │
│ 12251e78 08-19 19:45 feat(cli): 添加 GRV 风格 - costa │
│ > f940a408 08-19 19:30 feat(tui): 优化查询历史 - costa│
├────────────────────────────────────────────────────────┤
│ Commit Info                                           │
│ Hash: f940a408...                                     │
│ Message: feat(tui): 优化查询历史 TUI                   │
│ Author: costa                                         │
├────────────────────────────────────────────────────────┤
│ Git Diff                                              │
│ 📁 diff --git a/src/tui.rs b/src/tui.rs              │
│ 📍 @@ -123,6 +123,15 @@                              │
│ + 新增的代码行                                         │
│ - 删除的代码行                                         │
└────────────────────────────────────────────────────────┘
 NORMAL | Tab 1/1 | 100 commits
```

### 快捷键参考

| 按键 | 功能 |
|------|------|
| `↑/k` | 向上移动 |
| `↓/j` | 向下移动 |
| `g` | 跳到第一个 |
| `G` | 跳到最后一个 |
| `f/PgDn` | 向下翻页 |
| `b/PgUp` | 向上翻页 |
| `Enter/x` | 查看提交 diff |
| `d` | 切换详情面板 |
| `r` | 刷新日志 |
| `h` | 切换语法高亮 |
| `/` | 搜索 |
| `?` | 帮助 |
| `q` | 退出 |

### 分屏模式

- `Ctrl+s` - 循环切换分屏模式（无/水平/垂直）
- `Ctrl+w` - 在分屏之间切换焦点
- `:vsplit` - 垂直分屏
- `:hsplit` - 水平分屏

### Vim 风格命令

按 `:` 进入命令模式：

- `:q` - 退出
- `:vsplit` - 垂直分屏
- `:hsplit` - 水平分屏
- `:tab NAME` - 新建标签页
- `:help` - 显示帮助

## 技术实现

- 使用 `tokio::process::Command` 异步执行 Git 命令
- 实时加载选中提交的 diff 内容
- 格式化 diff 输出，添加图标和颜色
- 支持大文件 diff 的增量显示

## 已知限制

- TUI 需要在交互式终端中运行
- 首次加载可能需要几秒钟（取决于仓库大小）
- 超长 diff 内容会被截断显示（8000 字符）

## 故障排除

如果遇到问题：

1. 确保在 Git 仓库中运行
2. 检查 Git 命令是否可用：`git --version`
3. 使用调试模式：`AI_COMMIT_DEBUG=1 ai-commit --query-tui-pro`