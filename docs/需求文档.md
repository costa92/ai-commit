# ai-commit 需求文档

## 一、项目简介

ai-commit 是一个基于 Rust 开发的智能 Git 提交工具，集成本地/远程大模型（如 Ollama、Deepseek），自动根据代码变更生成符合 Conventional Commits 规范的提交信息，提升团队协作效率和提交规范性。

---

## 二、主要功能

1. **自动生成 Commit Message**
   - 根据 `git diff --cached` 获取暂存区变更，自动生成提交信息。
   - 支持通过 AI 大模型（Ollama、Deepseek）生成内容。
2. **支持多种 AI Provider**
   - 可通过命令行或 .env 配置选择 Ollama 或 Deepseek。
   - 支持自定义模型名称、API 地址、API Key。
3. **提交规范**
   - 生成的提交信息严格遵循 Conventional Commits 规范。
   - 支持自定义提示词模板（commit-prompt.txt），灵活适配团队规范。
4. **自动 git add/commit/push**
   - 支持自动 `git add .`，可通过参数关闭。
   - 支持自动 `git commit`，并可选自动 `git push`。
5. **高度可配置与扩展**
   - 所有参数均可通过命令行或 .env 文件配置。
   - 代码结构模块化，便于二次开发和功能扩展。

---

## 三、命令行参数

| 参数           | 说明                                   | 默认值      |
|----------------|----------------------------------------|-------------|
| --provider     | AI 提交生成服务（ollama/deepseek）     | ollama      |
| --model/-m     | AI 模型名称                            | mistral     |
| --no-add       | 不自动执行 git add .                   | false       |
| --push         | commit 后自动 git push                 | false       |
| --push-branches| 推送 tag 时同时推送 master develop main 分支 | false   |
| --show-tag     | 显示最新的 tag 和备注信息              | false       |
| --new-tag      | 创建新的 tag（版本号自动递增）         | false       |


---

## 四、环境变量与配置

- 推荐将 `.env` 文件放在 `~/.ai-commit/` 目录下（如 `~/.ai-commit/.env`），避免与其他项目冲突。
- 也可放在项目根目录（ai-commit/），此时仅对当前项目生效。
- 程序会优先加载 `~/.ai-commit/.env`，如不存在则加载项目根目录下的 `.env`。
- 这样可实现全局统一配置与项目级个性化配置的灵活切换。
- 支持通过命令行参数和 .env 文件灵活配置：
  - `AI_COMMIT_PROVIDER`：AI 服务类型（ollama/deepseek）
  - `AI_COMMIT_MODEL`：模型名称
  - `AI_COMMIT_OLLAMA_URL`：Ollama API 地址
  - `AI_COMMIT_DEEPSEEK_URL`：Deepseek API 地址
  - `AI_COMMIT_DEEPSEEK_API_KEY`：Deepseek API Key
  - `AI_COMMIT_PROMPT_PATH`：自定义提示词模板路径

---

## 五、AI 模型支持

- **Ollama**：本地大模型服务，默认地址 `http://localhost:11434/api/generate`
- **Deepseek**：云端大模型服务，需配置 API Key
- 支持自定义模型名称和 API 地址

---

## 六、提交规范

- 采用 Conventional Commits 规范，示例：
  ```
  feat(parser): 支持数组解析
  
  在新解析模块中增加了对数组的解析能力。
  ```
- 提交主题必须为中文，且不超过 50 个字
- 规范内容可在 `commit-prompt.txt` 配置

---

## 七、项目结构

```
src/
  main.rs         // 主流程
  args.rs         // 命令行参数解析
  git.rs          // git 操作相关
  prompt.rs       // 提示词模板处理
  ai.rs           // AI 相关逻辑
commit-prompt.txt // 提交提示词模板
.env              // 环境变量配置
```

---

## 八、扩展性说明

- 代码高度模块化，便于集成更多 AI provider 或自定义功能
- 提示词模板、提交规范、API 地址等均可灵活配置
- 适合团队协作、CI/CD 自动化等多种场景

---

## 九、未来可扩展方向

- 支持更多 AI 服务（如 OpenAI、通义千问等）
- 支持多语言提交规范
- 集成 PR/Issue 自动生成
- Web UI 或 VSCode 插件集成 
