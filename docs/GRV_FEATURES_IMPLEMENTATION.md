# GRV风格TUI增强功能实现

## 概述
基于GRV (Git Repository Viewer) 的界面设计，为ai-commit的查询历史TUI添加了专业的多窗口、多标签和命令模式功能。

## 新增核心功能

### 1. 多标签页系统 (Tab System)
- **Tab/Shift+Tab**: 切换标签页
- **:tab NAME**: 创建新标签页
- 动态标签管理
- 每个标签可以显示不同类型的内容

### 2. 分屏视图 (Split Views)
类似GRV的分屏功能：

#### 分屏模式
- **无分屏** (None): 单一视图
- **水平分屏** (Horizontal): 上下分割
- **垂直分屏** (Vertical): 左右分割

#### 快捷键
- **Ctrl+s**: 循环切换分屏模式
- **Ctrl+w**: 切换焦点窗口
- **:vsplit**: 垂直分屏
- **:hsplit**: 水平分屏

### 3. 命令模式 (Command Mode)
Vim风格的命令行：

```
:q          退出
:quit       退出
:split      切换分屏
:vsplit     垂直分屏
:hsplit     水平分屏
:tab NAME   新建标签
:help       显示帮助
```

### 4. 语法高亮 (Syntax Highlighting)
- **h键**: 切换语法高亮
- 查询类型自动着色
- 结果类型颜色编码：
  - feat: 绿色
  - fix: 黄色
  - docs: 蓝色

### 5. 滚动条支持 (Scrollbar)
- 结果视图自动显示滚动条
- 显示当前位置
- 上下箭头指示

### 6. 焦点管理 (Focus Management)
- 黄色边框表示当前焦点
- 白色边框表示非焦点窗口
- 焦点决定键盘操作的目标

## 界面布局示例

### 垂直分屏模式
```
┌─[History]─[Results]─[Stats]────────┬──────────────────────────┐
│ History                             │ Results                   │
├─────────────────────────────────────┼───────────────────────────┤
│ ✅ 19:04:42 author:test            │ commit1 - feat: feature   │
│ ✅ 19:03:58 message:feat           │ commit2 - fix: bugfix     │
│ > ✅ 19:03:29 since:2024-01-01     │ commit3 - docs: update    │
├─────────────────────────────────────┼───────────────────────────┤
│ Query: since:2024-01-01            │                       ↑   │
│ Time: 2025-09-08 19:03:29          │ [Results content]     │   │
│ Results: 207                        │                       │   │
│ Status: Success                     │                       ↓   │
└─────────────────────────────────────┴───────────────────────────┘
 NORMAL | Tab 1/2 | 5 entries [V-SPLIT]
```

### 水平分屏模式
```
┌─[History]─[Results]─────────────────────────────────────────────┐
│ History                                                         │
├─────────────────────────────────────────────────────────────────┤
│ ✅ 19:04:42 author:test                                        │
│ ✅ 19:03:58 message:feat                                       │
│ > ✅ 19:03:29 since:2024-01-01                                 │
├─────────────────────────────────────────────────────────────────┤
│ Results                                                         │
├─────────────────────────────────────────────────────────────────┤
│ commit1 - feat: add new feature                                │
│ commit2 - fix: resolve issue                                   │
│ commit3 - docs: update readme                                  │
└─────────────────────────────────────────────────────────────────┘
 NORMAL | Tab 1/2 | 5 entries [H-SPLIT]
```

## 操作流程

### 基本工作流
1. 启动TUI：`ai-commit --query-tui`
2. 浏览历史记录
3. 按Enter执行查询
4. 自动创建结果标签并分屏显示
5. 使用Ctrl+w切换焦点
6. 在结果窗口中滚动查看

### 高级工作流
1. 使用`/`搜索特定查询
2. 执行多个查询，每个创建新标签
3. 使用Tab切换不同结果
4. 使用`:vsplit`调整布局
5. 使用`h`切换语法高亮

## 快捷键总结

### 导航
| 键 | 功能 |
|---|------|
| ↑/k | 向上移动 |
| ↓/j | 向下移动 |
| Tab | 下一个标签 |
| Shift+Tab | 上一个标签 |

### 窗口管理
| 键 | 功能 |
|---|------|
| Ctrl+s | 切换分屏模式 |
| Ctrl+w | 切换焦点 |
| d | 切换详情面板 |

### 命令
| 键 | 功能 |
|---|------|
| : | 进入命令模式 |
| / | 搜索模式 |
| ? | 显示帮助 |
| h | 切换语法高亮 |
| Enter/x | 执行查询 |
| q | 退出 |

## 与GRV的对比

### 相似之处
- ✅ 多标签页系统
- ✅ 分屏视图
- ✅ Vim风格命令模式
- ✅ 焦点管理
- ✅ 语法高亮
- ✅ 滚动条

### ai-commit特色
- 专注于查询历史管理
- 自动执行查询并显示结果
- 集成的详情面板
- 简化的操作流程

## 技术实现

### 新增数据结构
```rust
pub enum ViewType {
    History,
    Results,
    Diff,
    Stats,
}

pub enum SplitMode {
    None,
    Horizontal,
    Vertical,
}

pub enum FocusedPane {
    Left,
    Right,
    Top,
    Bottom,
}
```

### 关键组件
- **Tab管理器**: 动态创建和切换标签
- **分屏渲染器**: 根据模式分割屏幕
- **命令解析器**: 处理vim风格命令
- **焦点控制器**: 管理多窗口焦点

## 性能优化
- 懒加载视图内容
- 只渲染可见区域
- 缓存渲染结果
- 增量更新

## 未来扩展
1. **更多视图类型**
   - Diff视图
   - 统计图表视图
   - 树形视图

2. **更多命令**
   - :save 保存查询
   - :load 加载查询
   - :export 导出结果

3. **鼠标支持**
   - 点击切换标签
   - 拖动调整分屏大小
   - 滚轮滚动

## 总结

通过实现这些GRV风格的功能，ai-commit的TUI现在提供了：

1. **专业的界面**: 多标签、分屏、滚动条
2. **高效的操作**: Vim风格快捷键和命令
3. **灵活的布局**: 可自定义的视图组合
4. **良好的反馈**: 焦点指示、语法高亮、状态栏

这使得查询历史管理变得更加专业和高效，提供了接近IDE级别的用户体验。